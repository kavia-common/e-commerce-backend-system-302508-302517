{"is_source_file": true, "format": "TypeScript", "description": "This file contains service functions for handling orders in an e-commerce backend, including placing new orders and listing user's order history.", "external_files": ["../../db/prisma", "../../errors/httpErrors"], "external_methods": ["prisma.$transaction", "prisma.order.findMany", "tx.product.findMany", "tx.product.update", "tx.order.create"], "published": ["placeOrder", "listMyOrders"], "classes": [], "methods": [{"name": "export async function placeOrder(userId: string, items: Array<{ productId: string; quantity: num/ placeOrder", "description": "Places an order for a user, validating stock, ensuring same currency among items, computing total, decrementing stock, and creating an order record atomically.", "scope": "", "scopeKind": ""}, {"name": "export async function listMyOrders(userId: string) { listMyOrders", "description": "Retrieves the list of orders for the specified user, including order items and associated product details.", "scope": "", "scopeKind": ""}], "calls": ["prisma.$transaction", "tx.product.findMany", "tx.product.update", "tx.order.create", "prisma.order.findMany"], "search-terms": ["orders.service.ts", "placeOrder", "listMyOrders", "transaction", "productId", "order", "backend_api"], "state": 2, "file_id": 28, "knowledge_revision": 70, "git_revision": "acdf6c5f71c0ea8b20a8614e60589a49d7717633", "ctags": [{"_type": "tag", "name": "item", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/orders/orders.service.ts", "pattern": "/^    for (const item of items) {$/", "language": "TypeScript", "kind": "constant", "scope": "placeOrder", "scopeKind": "function"}, {"_type": "tag", "name": "listMyOrders", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/orders/orders.service.ts", "pattern": "/^export async function listMyOrders(userId: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "order", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/orders/orders.service.ts", "pattern": "/^    const order = await tx.order.create({$/", "language": "TypeScript", "kind": "constant", "scope": "placeOrder", "scopeKind": "function"}, {"_type": "tag", "name": "placeOrder", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/orders/orders.service.ts", "pattern": "/^export async function placeOrder(userId: string, items: Array<{ productId: string; quantity: num/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "product", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/orders/orders.service.ts", "pattern": "/^      const product = productById.get(item.productId)!;$/", "language": "TypeScript", "kind": "constant", "scope": "placeOrder", "scopeKind": "function"}, {"_type": "tag", "name": "productById", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/orders/orders.service.ts", "pattern": "/^    const productById = new Map(products.map((p) => [p.id, p]));$/", "language": "TypeScript", "kind": "constant", "scope": "placeOrder", "scopeKind": "function"}, {"_type": "tag", "name": "productIds", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/orders/orders.service.ts", "pattern": "/^    const productIds = [...new Set(items.map((i) => i.productId))];$/", "language": "TypeScript", "kind": "constant", "scope": "placeOrder", "scopeKind": "function"}, {"_type": "tag", "name": "products", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/orders/orders.service.ts", "pattern": "/^    const products = await tx.product.findMany({ where: { id: { in: productIds }, active: true }/", "language": "TypeScript", "kind": "constant", "scope": "placeOrder", "scopeKind": "function"}], "hash": "564af1a82443adb042da06e71a7fd5d8", "format-version": 4, "code-base-name": "backend_api", "filename": "backend_api/src/modules/orders/orders.service.ts", "revision_history": [{"70": "acdf6c5f71c0ea8b20a8614e60589a49d7717633"}]}