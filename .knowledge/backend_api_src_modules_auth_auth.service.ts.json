{"is_source_file": true, "format": "TypeScript", "description": "This file implements authentication-related functionalities including user registration, login, password hashing, JWT token signing, and optional initial admin user creation. It manages user credentials, token generation, and interacts with the database via Prisma ORM.", "external_files": ["../../db/prisma", "../../errors/httpErrors"], "external_methods": ["bcrypt.hash", "bcrypt.compare", "jwt.sign", "prisma.user.findUnique", "prisma.user.create"], "published": ["register", "login", "ensureAdminExists"], "classes": [], "methods": [{"name": "function getSaltRounds(): number { getSaltRounds", "description": "Retrieves salt rounds for bcrypt hashing from environment variables, defaulting to 12 if invalid.", "scope": "", "scopeKind": ""}, {"name": "function getJwtSecret(): string { getJwtSecret", "description": "Fetches the JWT secret key from environment variables, throwing an error if missing.", "scope": "", "scopeKind": ""}, {"name": "function getJwtExpiresIn(): string { getJwtExpiresIn", "description": "Gets the token expiry duration from environment variables, defaulting to '7d'.", "scope": "", "scopeKind": ""}, {"name": "async function hashPassword(password: string): Promise<string> { hashPassword", "description": "Hashes a password string using bcrypt with configured salt rounds.", "scope": "", "scopeKind": ""}, {"name": "async function verifyPassword(password: string, passwordHash: string): Promise<boolean> { verifyPassword", "description": "Compares a plaintext password with a hashed password to verify correctness.", "scope": "", "scopeKind": ""}, {"name": "function signToken(payload: { sub: string; email: string; role: Role }): string { signToken", "description": "Creates a JWT token with user payload information, signed with the secret key.", "scope": "", "scopeKind": ""}, {"name": "export async function ensureAdminExists() { ensureAdminExists", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export async function login(email: string, password: string) { login", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "export async function register(email: string, password: string) { register", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["prisma.user.findUnique", "prisma.user.create", "bcrypt.hash", "bcrypt.compare", "jwt.sign", "hashPassword"], "search-terms": ["auth.service.ts", "JWT_SECRET", "hashPassword", "signToken", "ensureAdminExists", "bcrytp", "prisma", "Role", "auth"], "state": 2, "file_id": 20, "knowledge_revision": 62, "git_revision": "acdf6c5f71c0ea8b20a8614e60589a49d7717633", "ctags": [{"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const email = process.env.ADMIN_EMAIL;$/", "language": "TypeScript", "kind": "constant", "scope": "ensureAdminExists", "scopeKind": "function"}, {"_type": "tag", "name": "ensureAdminExists", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^export async function ensureAdminExists() {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "existing", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const existing = await prisma.user.findUnique({ where: { email } });$/", "language": "TypeScript", "kind": "constant", "scope": "ensureAdminExists", "scopeKind": "function"}, {"_type": "tag", "name": "existing", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const existing = await prisma.user.findUnique({ where: { email } });$/", "language": "TypeScript", "kind": "constant", "scope": "register", "scopeKind": "function"}, {"_type": "tag", "name": "getJwtExpiresIn", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^function getJwtExpiresIn(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getJwtSecret", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^function getJwtSecret(): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "getSaltRounds", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^function getSaltRounds(): number {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "hashPassword", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^async function hashPassword(password: string): Promise<string> {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "login", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^export async function login(email: string, password: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "ok", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const ok = await verifyPassword(password, user.passwordHash);$/", "language": "TypeScript", "kind": "constant", "scope": "login", "scopeKind": "function"}, {"_type": "tag", "name": "parsed", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const parsed = Number(raw);$/", "language": "TypeScript", "kind": "constant", "scope": "getSaltRounds", "scopeKind": "function"}, {"_type": "tag", "name": "password", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const password = process.env.ADMIN_PASSWORD;$/", "language": "TypeScript", "kind": "constant", "scope": "ensureAdminExists", "scopeKind": "function"}, {"_type": "tag", "name": "passwordHash", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const passwordHash = await hashPassword(password);$/", "language": "TypeScript", "kind": "constant", "scope": "ensureAdminExists", "scopeKind": "function"}, {"_type": "tag", "name": "passwordHash", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const passwordHash = await hashPassword(password);$/", "language": "TypeScript", "kind": "constant", "scope": "register", "scopeKind": "function"}, {"_type": "tag", "name": "raw", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const raw = process.env.BCRYPT_SALT_ROUNDS ?? '12';$/", "language": "TypeScript", "kind": "constant", "scope": "getSaltRounds", "scopeKind": "function"}, {"_type": "tag", "name": "register", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^export async function register(email: string, password: string) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "saltRounds", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const saltRounds = getSaltRounds();$/", "language": "TypeScript", "kind": "constant", "scope": "hashPassword", "scopeKind": "function"}, {"_type": "tag", "name": "secret", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const secret = process.env.JWT_SECRET;$/", "language": "TypeScript", "kind": "constant", "scope": "getJwtSecret", "scopeKind": "function"}, {"_type": "tag", "name": "signToken", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^function signToken(payload: { sub: string; email: string; role: Role }): string {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const token = signToken({ sub: user.id, email: user.email, role: user.role });$/", "language": "TypeScript", "kind": "constant", "scope": "login", "scopeKind": "function"}, {"_type": "tag", "name": "token", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const token = signToken({ sub: user.id, email: user.email, role: user.role });$/", "language": "TypeScript", "kind": "constant", "scope": "register", "scopeKind": "function"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const user = await prisma.user.create({$/", "language": "TypeScript", "kind": "constant", "scope": "register", "scopeKind": "function"}, {"_type": "tag", "name": "user", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^  const user = await prisma.user.findUnique({ where: { email } });$/", "language": "TypeScript", "kind": "constant", "scope": "login", "scopeKind": "function"}, {"_type": "tag", "name": "verifyPassword", "path": "/home/kavia/workspace/code-generation/e-commerce-backend-system-302508-302517/backend_api/src/modules/auth/auth.service.ts", "pattern": "/^async function verifyPassword(password: string, passwordHash: string): Promise<boolean> {$/", "language": "TypeScript", "kind": "function"}], "hash": "a297be29b0588bdff745efa8271076c6", "format-version": 4, "code-base-name": "backend_api", "filename": "backend_api/src/modules/auth/auth.service.ts", "revision_history": [{"62": "acdf6c5f71c0ea8b20a8614e60589a49d7717633"}]}